#!/bin/sh
set -eu

usage() {
cat <<EOF
Usage:
 depthchargectl [options] command ...

Manage ChromeOS kernel partitions.

Global options:
 -h, --help                 Show this help message.
 -v, --verbose              Print more detailed output.
EOF
}

. "lib/msg.sh"


# Parse options and arguments
# ---------------------------

while [ "$#" -gt 0 ]; do
    case "$1" in
        # Global options:
        -h|--help)      usage;          exit 0 ;;
        -v|--verbose)   VERBOSE=yes;    shift 1 ;;

        # End of options.
        -*) usage_error "Global option '$1' not understood." ;;
        *)  COMMAND="$1"; shift; break ;;
    esac
done


# Set argument defaults
# ---------------------

# Verbosity options.
: "${VERBOSE:=no}"
: "${QUIET:=no}"
: "${SILENT:=no}"

# List partitions by default.
: "${COMMAND:=list}"

export VERBOSE QUIET SILENT
readonly COMMAND


# Execute chosen command
# ----------------------

cmd="lib/depthchargectl/${COMMAND}.sh"
if [ ! -r "$cmd" ]; then
    usage_error "'$COMMAND' is not a valid depthchargectl command."
elif [ ! -x "$cmd" ]; then
    error "Script for '$COMMAND' isn't executable."
fi

# We've only parsed arguments upto and including the command.
"$cmd" "$@"
